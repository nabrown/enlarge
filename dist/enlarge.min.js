/*! fg-enlarge - v0.3.1 - 2018-08-18
* Copyright (c) 2018 Scott Jehl, Filament Group, Inc.; Licensed MIT */

!function(G){var t,a,e=window.navigator&&window.navigator.msPointerEnabled&&window.MSGesture,i="ontouchstart"in window||e||window.DocumentTouch&&document instanceof DocumentTouch;a={loading:"fetching detail&hellip;",hoverZoomWithoutClick:!1,delay:200,flyout:{width:"300px",height:"300px"},placement:"flyoutloupe",magnification:5},t={loading:"fetching detail&hellip;",hoverZoomWithoutClick:!0,delay:200,flyout:{width:"300px",height:"300px"},placement:"flyoutright",magnification:3};var n=function(){var R=G.jQuery,S="enlarge";R.fn[S]=function(){var F,L=arguments,Q=R(this).data("options");"string"!=typeof Q&&(o=i?R.extend({},a,Q.touchOptions):R.extend({},t,Q),R(this).data("options",o));var e=this.each(function(){var a=R(this),i=this,e=G.document.createElement("img"),n="srcset"in e&&"sizes"in e,t=R(this).find("a");if(!t.length)throw new Error(S+": requires an anchor element with `href` for the enlarged image source");var h,g,d,s=a.find("img")[0],p=s,r=p.src,l=R(p).attr("srcset"),c=R(p).attr("sizes"),u=t[0].href,m=(t[0].innerText,S+"-zoomed"),f=S+"-delay",v=R(p).closest(".enlarge_contain"),k=v,y=R(p).closest(".enlarge_pane")||a,b=R(this).data("zoomParent")||y;R(this).data("zoomParent",b);var w=a.data("zoomed")||!1;a.data("zoomed",w),a.data("lockedZoom",a.data("lockedZoom")||!1);var z=S+"-locked";if(!v.length)throw new Error(S+": requires an element above the image marked with the class `enlarge_contain`");if("string"!=typeof Q){var C,x,Z,W;O(),a.data("updateOptions",function(e){o=R.extend(o,e),R(this).data("options",o),T(),E(),_=o.hoverZoomWithoutClick,o.image&&o.image.sizes&&(c=o.image.sizes,H()),O(),o.disabled&&a.data("zoomed")&&N()});var _=o.hoverZoomWithoutClick,D=R('<div class="enlarge_flyout"></div>').append(v.clone());D.insertAfter(y),T(),E(),t.bind("keydown",function(e){var t;13!==e.keyCode&&32!==e.keyCode||"inline"!==(t=o.placement)&&(R(i).bind(S+".after-zoom-out",function e(){o.placement=t,T(),R(i).unbind(S+".after-zoom-out",e)}),o.placement="inline",T()),32===e.keyCode&&(e.preventDefault(),R(this).trigger("click"))}).bind("click",function(e){e.preventDefault(),N()}),R(G).bind("resize",function(e){a.data("lockedZoom")&&N()}),R(G.document).bind("mouseup",function(e){a.data("lockedZoom")&&!R(e.target).closest(y).length&&N()}),R(s).bind("mouseenter touchstart",function(e){d||(v.append('<div class="enlarge_loader"><div>'+o.loading+"</div></div>"),d=!0),"touchstart"===e.type&&(W=!0),W&&"mouseenter"===e.type||"mouseenter"===e.type&&!W&&!_||a.data("lockedZoom")||Z||(Z=!0,v.addClass(f),x=setTimeout(function(){v.removeClass(f),A(),H(function(){I(),C=!0,j(e)})},o.delay))}).bind("mousemove touchmove",j).bind("mouseleave touchend",function(e){var t;Z=!1,w&&!a.data("lockedZoom")&&(A(),H(function(){I()})),t=e,v.removeClass(f),clearTimeout(x),(C=!1)!==o.hoverZoomWithoutClick||W||(_=!1),W&&"mouseleave"===t.type&&(W=!1)}).bind("click",function(e){e.preventDefault(),W&&"inline"===o.placement&&N(),!1!==o.hoverZoomWithoutClick||W||((_=!_)?R(this).trigger("mouseenter"):R(this).trigger("mouseleave"))}),R(this).bind("keydown keyup",function(e){37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode?(e.stopImmediatePropagation(),a.data("lockedZoom")||e.preventDefault()):"keyup"===e.type&&R(this).data("lockedZoom")&&27===e.keyCode&&(N(),t[0].focus(),e.stopImmediatePropagation())}),y.bind("scroll",function(){a.data("zoomed")&&(A(),H(function(){a.data("lockedZoom")&&q(),I()}))})}else{var P=Array.prototype.slice.call(L,1);switch(Q){case"in":a.data("zoomed")||N();break;case"out":a.data("zoomed")&&N();break;case"isZoomed":F=a.data("zoomed");break;case"updateOptions":a.data("updateOptions")(P[0])}}function T(){"inline"===o.placement?(p=s,b=y,a.data("zoomParent",b),k=v):(p=D.find("img")[0],b=k=D,a.data("zoomParent",b))}function E(){D.css({width:o.flyout.width,height:o.flyout.height,top:"",left:"","margin-left":"","margin-top":""}),h=D.width(),g=D.height();var e=o.placement.match(/left|right/);e&&(D.css(e[0],-h-10+"px"),D.css("top","0")),o.placement.match(/loupe/)&&D.css({"margin-left":-h/2+"px","margin-top":-g/2+"px"}),D[0].className=D[0].className.replace(/enlarge_flyout\-[^$\s]+/," "),D.addClass("enlarge_flyout-"+o.placement)}function O(){o.disabled?a.addClass("enlarge_disabled"):a.removeClass("enlarge_disabled")}function A(){w=!a.data("zoomed"),a.data("zoomed",w)}function H(t){if(t=t||function(){},w){if(o.disabled)return t(),!1;var a=new Image;a.className="enlarge_img-loading",a.onload=function(){var e;p.sizes=a.sizes,n&&l||(p.src=u),R(a).remove(),(e=v.find(".enlarge_loader")).length&&(e.on("animationend",function(){e.remove()}),e.addClass("fadeOut")),t()},a.sizes=B()+"px",n&&l?l&&(a.srcset=l):a.src=u,R(a).insertBefore(p)}else p.sizes=c,n||(p.src=r),t()}function q(){if(a.data("lockedZoom"))y.add(b).removeClass(z),a.data("lockedZoom",lockedZoom=!1),k.removeAttr("tabindex");else{if(o.disabled)return!1;y.add(b).addClass(z),a.data("lockedZoom",lockedZoom=!0),k.attr("tabindex","0"),k[0].focus()}}function B(){return y[0].offsetWidth*o.magnification}function I(){if(a.data("zoomed")){if(o.disabled)return!1;"inline"===o.placement&&v.add(y).css({width:y[0].offsetWidth+"px",height:parseFloat(getComputedStyle(y[0]).height)+"px"}),b.addClass(m),R(p).css("width",B()+"px"),R(i).trigger(S+".after-zoom-in")}else b.removeClass(m),"inline"===o.placement&&v.add(y).css({width:"",height:""}),R(p).css("width",""),R(i).trigger(S+".after-zoom-out")}function N(){if(o.disabled&&!a.data("zoomed"))return!1;A(),H(function(){var e,t,o,a;q(),I(),e=k.width(),t=k.height(),o=p.offsetWidth,a=p.offsetHeight,k[0].scrollLeft=o/2-e/2,k[0].scrollTop=a/2-t/2})}function j(e){if(C){if(W&&"mousemove"===e.type)return;var t=e.originalEvent||e,a=t.touches?t.touches[0]:t;e.preventDefault();var i=a.clientX-v[0].getBoundingClientRect().left,n=a.clientY-v[0].getBoundingClientRect().top;if(o.placement.match(/loupe/)){var d=(t.touches?-h/1.3:-h/2)+"px",s=(t.touches?-g/1.3:-g/2)+"px";requestAnimationFrame(function(){D.css({top:n+"px",left:i+"px","margin-left":d,"margin-top":s})})}var r=v[0].offsetWidth,l=v[0].offsetHeight,c=p.offsetWidth,u=p.offsetHeight,m=k[0].offsetWidth,f=k[0].offsetHeight;k[0].scrollLeft=i/r*(c-m),k[0].scrollTop=n/l*(u-f)}}});return void 0!==F?F:e}};"undefined"!=typeof module?module.exports=n:n()}("undefined"!=typeof global?global:this),function(t,e,o){var a="enlarge";t(document).bind("enhance",function(e){t(".enlarge",e.target)[a]()})}(jQuery);